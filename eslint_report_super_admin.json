[{"filePath":"C:\\Users\\oscar\\Bot_Whatsapp\\lia-frontend\\app\\super-admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Logo' is defined but never used.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1151,1154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1151,1154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signOut' is assigned a value but never used.","line":26,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1585,1588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1585,1588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1955,1958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1955,1958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2209,2212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2209,2212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2373,2376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2373,2376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3295,3298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3295,3298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filteredUsers' is assigned a value but never used.","line":160,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6293,6296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6293,6296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filteredLogs' is assigned a value but never used.","line":164,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":164,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6545,6548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6545,6548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6684,6687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6684,6687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":191,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7295,7298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7295,7298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7510,7513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7510,7513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8293,8296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8293,8296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8566,8569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8566,8569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8697,8700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8697,8700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":357,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15241,15244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15241,15244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":357,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15258,15261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15258,15261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":414,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19497,19500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19497,19500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20289,20292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20289,20292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":634,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":634,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34408,34411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34408,34411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":671,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":671,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35833,35836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35833,35836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":671,"column":170,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":671,"endColumn":173,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35896,35899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35896,35899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport DashboardHeader from '@/components/DashboardHeader';\r\nimport Logo from '@/components/Logo';\r\nimport EditHoldingModal from '@/components/EditHoldingModal';\r\nimport ConfigurationView from '@/components/ConfigurationView';\r\nimport CreateHoldingModal from '@/components/CreateHoldingModal';\r\nimport CreateUserModalSuperAdmin from '@/components/CreateUserModalSuperAdmin';\r\nimport EditUserModalSuperAdmin from '@/components/EditUserModalSuperAdmin';\r\nimport PendingUsersActivation from '@/components/admin/PendingUsersActivation';\r\nimport BulkUploadStoresModal from '@/components/admin/BulkUploadStoresModal';\r\nimport BulkUploadUsersModal from '@/components/admin/BulkUploadUsersModal';\r\nimport { db } from '@/lib/firebase';\r\nimport { collection, getDocs, onSnapshot, query, orderBy, where, deleteDoc, doc } from 'firebase/firestore';\r\nimport GlobalCandidatesView from '@/components/admin/GlobalCandidatesView';\r\n\r\n// Mock data removed to avoid duplicates with Firestore\r\nconst MOCK_LOGS: any[] = [];\r\n\r\ntype Tab = 'empresas' | 'usuarios' | 'candidatos' | 'logs' | 'pending' | 'configuracion';\r\n\r\nexport default function SuperAdminDashboard() {\r\n    const { user, claims, loading, signOut } = useAuth();\r\n    const router = useRouter();\r\n    const [activeTab, setActiveTab] = useState<Tab>('empresas');\r\n    const [holdingFilter, setHoldingFilter] = useState<string>('todos');\r\n    const [holdings, setHoldings] = useState<any[]>([]);\r\n\r\n    // Real-time counters for brands and stores\r\n    const [brandCounts, setBrandCounts] = useState<Record<string, number>>({});\r\n    const [storeCounts, setStoreCounts] = useState<Record<string, number>>({});\r\n\r\n    // Edit modal\r\n    const [showEditModal, setShowEditModal] = useState(false);\r\n    const [selectedHolding, setSelectedHolding] = useState<any | null>(null);\r\n\r\n    // Create modal\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n\r\n    // Create user modal\r\n    const [showCreateUserModal, setShowCreateUserModal] = useState(false);\r\n    const [users, setUsers] = useState<any[]>([]);\r\n\r\n    // Edit user modal\r\n    const [showEditUserModal, setShowEditUserModal] = useState(false);\r\n    const [selectedUser, setSelectedUser] = useState<any>(null);\r\n\r\n    // Bulk upload modals\r\n    const [showBulkStoreModal, setShowBulkStoreModal] = useState(false);\r\n    const [showBulkUserModal, setShowBulkUserModal] = useState(false);\r\n    const [selectedHoldingIdForUpload, setSelectedHoldingIdForUpload] = useState<string>('');\r\n\r\n    useEffect(() => {\r\n        if (!loading && (!user || claims?.role !== 'super_admin')) {\r\n            router.push('/login');\r\n        }\r\n    }, [user, claims, loading, router]);\r\n\r\n    // Load holdings from Firestore in real-time\r\n    useEffect(() => {\r\n        const holdingsRef = collection(db, 'holdings');\r\n        const q = query(holdingsRef, orderBy('createdAt', 'desc'));\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const loadedHoldings = snapshot.docs.map(doc => ({\r\n                ...doc.data(),\r\n                firestoreId: doc.id\r\n            }));\r\n            setHoldings(loadedHoldings as any);\r\n            console.log('‚úÖ Holdings cargados desde Firestore:', loadedHoldings.length);\r\n        }, (error) => {\r\n            console.error('Error cargando holdings:', error);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Count brands per holding in real-time\r\n    useEffect(() => {\r\n        const marcasRef = collection(db, 'marcas');\r\n\r\n        const unsubscribe = onSnapshot(marcasRef, (snapshot) => {\r\n            const counts: Record<string, number> = {};\r\n\r\n            snapshot.docs.forEach(doc => {\r\n                const data = doc.data();\r\n                const holdingId = data.holdingId;\r\n                if (holdingId) {\r\n                    counts[holdingId] = (counts[holdingId] || 0) + 1;\r\n                }\r\n            });\r\n\r\n            setBrandCounts(counts);\r\n            console.log('‚úÖ Conteo de marcas actualizado:', counts);\r\n        }, (error) => {\r\n            console.error('Error contando marcas:', error);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Count stores per holding in real-time\r\n    useEffect(() => {\r\n        const tiendasRef = collection(db, 'tiendas');\r\n\r\n        const unsubscribe = onSnapshot(tiendasRef, (snapshot) => {\r\n            const counts: Record<string, number> = {};\r\n\r\n            snapshot.docs.forEach(doc => {\r\n                const data = doc.data();\r\n                const holdingId = data.holdingId;\r\n                if (holdingId) {\r\n                    counts[holdingId] = (counts[holdingId] || 0) + 1;\r\n                }\r\n            });\r\n\r\n            setStoreCounts(counts);\r\n            console.log('‚úÖ Conteo de tiendas actualizado:', counts);\r\n        }, (error) => {\r\n            console.error('Error contando tiendas:', error);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Load users from Firestore in real-time\r\n    useEffect(() => {\r\n        const usersRef = collection(db, 'userAssignments');\r\n        const q = query(usersRef, orderBy('createdAt', 'desc'));\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const loadedUsers = snapshot.docs.map(doc => {\r\n                const data = doc.data();\r\n                return {\r\n                    id: doc.id,\r\n                    email: data.email,\r\n                    nombre: data.displayName,\r\n                    rol: data.role,\r\n                    tenant: data.holdingId || 'Sin asignar',\r\n                    activo: data.active\r\n                };\r\n            });\r\n            setUsers(loadedUsers);\r\n            console.log('‚úÖ Usuarios cargados desde Firestore:', loadedUsers.length);\r\n        }, (error) => {\r\n            console.error('Error cargando usuarios:', error);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    if (loading || !user) {\r\n        return null;\r\n    }\r\n\r\n    // Filtrar datos seg√∫n holding seleccionado\r\n    const filteredUsers = holdingFilter === 'todos'\r\n        ? users\r\n        : users.filter((u: any) => u.tenant.toLowerCase().includes(holdingFilter.toLowerCase()));\r\n\r\n    const filteredLogs = holdingFilter === 'todos'\r\n        ? MOCK_LOGS\r\n        : MOCK_LOGS.filter(l => l.holding === holdingFilter);\r\n\r\n    const handleEditHolding = (holding: any) => {\r\n        setSelectedHolding(holding);\r\n        setShowEditModal(true);\r\n    };\r\n\r\n    const handleSaveHolding = (updatedHolding: any) => {\r\n        // Actualizar el holding en la lista\r\n        setHoldings(holdings.map(h =>\r\n            h.id === updatedHolding.id\r\n                ? {\r\n                    ...h,\r\n                    plan: updatedHolding.plan,\r\n                    activo: updatedHolding.activo,\r\n                    config: updatedHolding.config\r\n                }\r\n                : h\r\n        ));\r\n\r\n        console.log('‚úÖ Holding actualizado:', updatedHolding);\r\n        console.log('üìä Config guardada:', updatedHolding.config);\r\n        setShowEditModal(false);\r\n    };\r\n\r\n    const handleCreateHolding = (newHolding: any) => {\r\n        setHoldings([...holdings, newHolding]);\r\n        console.log('‚úÖ Nueva empresa creada:', newHolding);\r\n        setShowCreateModal(false);\r\n    };\r\n\r\n    const handleDeleteHolding = async (holding: any) => {\r\n        if (!confirm(`¬øEliminar la empresa \"${holding.nombre}\"?\\n\\nEsta acci√≥n eliminar√° tambi√©n todas las marcas y tiendas asociadas.`)) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Delete the holding document\r\n            await deleteDoc(doc(db, 'holdings', holding.id));\r\n\r\n            // Update local state\r\n            setHoldings(holdings.filter(h => h.id !== holding.id));\r\n\r\n            alert(`‚úÖ Empresa \"${holding.nombre}\" eliminada exitosamente`);\r\n            console.log('‚úÖ Empresa eliminada:', holding.id);\r\n        } catch (error) {\r\n            console.error('Error eliminando empresa:', error);\r\n            alert('‚ùå Error eliminando empresa. Ver consola para detalles.');\r\n        }\r\n    };\r\n\r\n    const handleCreateUser = (newUser: any) => {\r\n        const userWithId = { ...newUser, id: String(users.length + 1) };\r\n        setUsers([...users, userWithId]);\r\n        console.log('‚úÖ Nuevo usuario creado:', userWithId);\r\n        setShowCreateUserModal(false);\r\n    };\r\n\r\n    const handleEditUser = (user: any) => {\r\n        setSelectedUser(user);\r\n        setShowEditUserModal(true);\r\n    };\r\n\r\n    const handleSaveUser = (updatedUser: any) => {\r\n        setUsers(users.map(u => u.id === updatedUser.id ? updatedUser : u));\r\n        console.log('‚úÖ Usuario actualizado:', updatedUser);\r\n        setShowEditUserModal(false);\r\n    };\r\n\r\n    const handleDeleteUser = async (userId: string, userEmail: string) => {\r\n        if (!confirm(`¬øEliminar usuario ${userEmail}?`)) return;\r\n\r\n        try {\r\n            // Delete from Firestore\r\n            const assignmentsRef = collection(db, 'userAssignments');\r\n            const q = query(assignmentsRef, where('email', '==', userEmail));\r\n            const snapshot = await getDocs(q);\r\n\r\n            if (!snapshot.empty) {\r\n                const docRef = doc(db, 'userAssignments', snapshot.docs[0].id);\r\n                await deleteDoc(docRef);\r\n\r\n                // Update local state\r\n                setUsers(users.filter(u => u.id !== userId));\r\n                console.log('‚úÖ Usuario eliminado');\r\n                alert('Usuario eliminado exitosamente');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error eliminando usuario:', error);\r\n            alert('Error al eliminar usuario');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50\">\r\n            {/* Standardized Header */}\r\n            <DashboardHeader\r\n                title=\"Super Admin\"\r\n                subtitle=\"Control Total del Sistema\"\r\n                onConfigClick={() => setActiveTab('configuracion')}\r\n            />\r\n\r\n            {/* Main Content */}\r\n            <main className=\"max-w-7xl mx-auto px-4 py-8\">\r\n                {/* Filtro Global de Holding */}\r\n                {activeTab !== 'empresas' && activeTab !== 'configuracion' && (\r\n                    <div className=\"flex items-center gap-3 animate-fade-in mb-6\">\r\n                        <label className=\"text-sm font-medium text-gray-700\">Filtrar por Holding:</label>\r\n                        <select\r\n                            value={holdingFilter}\r\n                            onChange={(e) => setHoldingFilter(e.target.value)}\r\n                            className=\"px-3 py-2 rounded-lg border border-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-violet-500 bg-white\"\r\n                        >\r\n                            <option value=\"todos\">üìä Todos los Holdings</option>\r\n                            {holdings.map(h => (\r\n                                <option key={h.id} value={h.nombre}>{h.nombre}</option>\r\n                            ))}\r\n                        </select>\r\n                        {holdingFilter !== 'todos' && (\r\n                            <button\r\n                                onClick={() => setHoldingFilter('todos')}\r\n                                className=\"text-sm text-violet-600 hover:text-violet-700 font-medium\"\r\n                            >\r\n                                Limpiar filtro\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                )}\r\n                {/* Navigation Tabs */}\r\n                <div className=\"flex gap-2 border-b border-gray-200 mb-8\">\r\n                    <button\r\n                        onClick={() => setActiveTab('empresas')}\r\n                        className={`px-4 py-2 font-medium transition-colors border-b-2 ${activeTab === 'empresas'\r\n                            ? 'border-violet-600 text-violet-600'\r\n                            : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                            }`}\r\n                    >\r\n                        üè¢ Empresas\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('usuarios')}\r\n                        className={`px-4 py-2 font-medium transition-colors border-b-2 ${activeTab === 'usuarios'\r\n                            ? 'border-violet-600 text-violet-600'\r\n                            : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                            }`}\r\n                    >\r\n                        üë• Usuarios\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('pending')}\r\n                        className={`px-4 py-2 font-medium transition-colors border-b-2 ${activeTab === 'pending'\r\n                            ? 'border-amber-600 text-amber-600'\r\n                            : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                            }`}\r\n                    >\r\n                        ‚è≥ Activar Usuarios\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('logs')}\r\n                        className={`px-4 py-2 font-medium transition-colors border-b-2 ${activeTab === 'logs'\r\n                            ? 'border-violet-600 text-violet-600'\r\n                            : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                            }`}\r\n                    >\r\n                        üìä Logs\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('candidatos')}\r\n                        className={`px-4 py-2 font-medium transition-colors border-b-2 ${activeTab === 'candidatos'\r\n                            ? 'border-green-600 text-green-600'\r\n                            : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                            }`}\r\n                    >\r\n                        üë• Candidatos (Global)\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Tab: Empresas */}\r\n                {activeTab === 'empresas' && (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h2 className=\"text-2xl font-bold text-gray-900\">Empresas Clientes</h2>\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        if (holdingFilter === 'todos') {\r\n                                            alert('Por favor selecciona un Holding primero para importar tiendas.');\r\n                                            return;\r\n                                        }\r\n                                        const h = holdings.find(h => h.nombre === holdingFilter);\r\n                                        if (h) {\r\n                                            setSelectedHoldingIdForUpload((h as any).id || (h as any).firestoreId);\r\n                                            setShowBulkStoreModal(true);\r\n                                        }\r\n                                    }}\r\n                                    className=\"px-4 py-2 border border-green-600 text-green-700 rounded-xl font-medium hover:bg-green-50 transition-colors flex items-center gap-2\"\r\n                                >\r\n                                    üìÅ Importar Tiendas\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setShowCreateModal(true)}\r\n                                    className=\"px-4 py-2 gradient-bg text-white rounded-xl font-medium hover:opacity-90 transition-opacity\"\r\n                                >\r\n                                    + Nueva Empresa\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* KPIs */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                            <div className=\"glass-card rounded-xl p-4\">\r\n                                <p className=\"text-sm text-gray-600 mb-1\">Total Empresas</p>\r\n                                <p className=\"text-3xl font-bold gradient-primary\">{holdings.length}</p>\r\n                            </div>\r\n                            <div className=\"glass-card rounded-xl p-4\">\r\n                                <p className=\"text-sm text-gray-600 mb-1\">Activos</p>\r\n                                <p className=\"text-3xl font-bold text-green-600\">{holdings.filter(h => h.activo).length}</p>\r\n                            </div>\r\n                            <div className=\"glass-card rounded-xl p-4\">\r\n                                <p className=\"text-sm text-gray-600 mb-1\">Total Marcas</p>\r\n                                <p className=\"text-3xl font-bold text-cyan-600\">{Object.values(brandCounts).reduce((sum, count) => sum + count, 0)}</p>\r\n                            </div>\r\n                            <div className=\"glass-card rounded-xl p-4\">\r\n                                <p className=\"text-sm text-gray-600 mb-1\">Total Tiendas</p>\r\n                                <p className=\"text-3xl font-bold text-amber-600\">{Object.values(storeCounts).reduce((sum, count) => sum + count, 0)}</p>\r\n                            </div>\r\n                            <div className=\"glass-card rounded-xl p-4\">\r\n                                <p className=\"text-sm text-gray-600 mb-1\">Total Usuarios</p>\r\n                                <p className=\"text-3xl font-bold text-violet-600\">{holdings.reduce((sum, h) => sum + h.usuarios, 0)}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Holdings List */}\r\n                        <div className=\"space-y-3\">\r\n                            {holdings.map(holding => (\r\n                                <div key={holding.id} className=\"glass-card rounded-xl p-6\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center gap-4\">\r\n                                            <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-violet-500 to-cyan-500 flex items-center justify-center text-white font-bold\">\r\n                                                {holding.nombre.substring(0, 2)}\r\n                                            </div>\r\n                                            <div>\r\n                                                <h3 className=\"text-lg font-semibold text-gray-900\">{holding.nombre}</h3>\r\n                                                <div className=\"flex items-center gap-4 text-sm text-gray-600 mt-1\">\r\n                                                    <span>{brandCounts[holding.id] || 0} marcas</span>\r\n                                                    <span>‚Ä¢</span>\r\n                                                    <span>{storeCounts[holding.id] || 0} tiendas</span>\r\n                                                    <span>‚Ä¢</span>\r\n                                                    <span>{(holding as any).config?.maxUsuarios || holding.usuarios} usuarios</span>\r\n                                                    <span>‚Ä¢</span>\r\n                                                    <span className=\"px-2 py-0.5 bg-violet-100 text-violet-700 rounded text-xs font-medium\">\r\n                                                        {holding.plan === 'full_stack' ? 'Full Stack' :\r\n                                                            holding.plan === 'rq_only' ? 'RQ Only' : 'Bot Only'}\r\n                                                    </span>\r\n                                                    <span>‚Ä¢</span>\r\n                                                    <span className=\"font-semibold text-green-600\">\r\n                                                        ${(holding as any).config?.precioMensual ||\r\n                                                            (holding.plan === 'full_stack' ? 499 :\r\n                                                                holding.plan === 'rq_only' ? 199 : 99)}/mes\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <span className={`px-3 py-1 rounded-lg text-sm font-medium ${holding.activo\r\n                                                ? 'bg-green-100 text-green-700'\r\n                                                : 'bg-gray-100 text-gray-700'\r\n                                                }`}>\r\n                                                {holding.activo ? '‚úì Activo' : '‚óã Inactivo'}\r\n                                            </span>\r\n                                            <button\r\n                                                onClick={() => handleEditHolding(holding)}\r\n                                                className=\"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors\"\r\n                                            >\r\n                                                Editar\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleDeleteHolding(holding)}\r\n                                                className=\"px-4 py-2 border border-red-300 text-red-600 rounded-lg text-sm font-medium hover:bg-red-50 transition-colors\"\r\n                                            >\r\n                                                üóëÔ∏è Eliminar\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Tab: Usuarios */}\r\n                {activeTab === 'usuarios' && (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h2 className=\"text-2xl font-bold text-gray-900\">Gesti√≥n de Usuarios</h2>\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={() => setShowBulkUserModal(true)}\r\n                                    className=\"px-4 py-2 border border-green-600 text-green-700 rounded-xl font-medium hover:bg-green-50 transition-colors flex items-center gap-2\"\r\n                                >\r\n                                    üìÅ Importar Usuarios\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setShowCreateUserModal(true)}\r\n                                    className=\"px-4 py-2 gradient-bg text-white rounded-xl font-medium hover:opacity-90 transition-opacity\"\r\n                                >\r\n                                    + Nuevo Usuario\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Users Table */}\r\n                        <div className=\"glass-card rounded-xl overflow-hidden\">\r\n                            <table className=\"w-full\">\r\n                                <thead className=\"bg-gray-50\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Usuario</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Rol</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Tenant</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Estado</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-200\">\r\n                                    {users.filter(u => holdingFilter === 'todos' || u.tenant.toLowerCase().includes(holdingFilter.toLowerCase())).map(usuario => (\r\n                                        <tr key={usuario.id} className=\"hover:bg-gray-50 transition-colors\">\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <div>\r\n                                                    <p className=\"font-medium text-gray-900\">{usuario.nombre}</p>\r\n                                                    <p className=\"text-sm text-gray-500\">{usuario.email}</p>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <span className=\"px-2 py-1 bg-cyan-100 text-cyan-700 rounded text-xs font-medium\">\r\n                                                    {usuario.rol}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-600\">{usuario.tenant}</td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <span className={`px-2 py-1 rounded text-xs font-medium ${usuario.activo ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\r\n                                                    }`}>\r\n                                                    {usuario.activo ? 'Activo' : 'Inactivo'}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <div className=\"flex gap-3\">\r\n                                                    <button\r\n                                                        onClick={() => handleEditUser(usuario)}\r\n                                                        className=\"text-violet-600 hover:text-violet-700 text-sm font-medium\"\r\n                                                    >\r\n                                                        Editar\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => handleDeleteUser(usuario.id, usuario.email)}\r\n                                                        className=\"text-red-600 hover:text-red-700 text-sm font-medium\"\r\n                                                    >\r\n                                                        Eliminar\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                )\r\n                }\r\n\r\n                {/* Tab: Pending Users Activation */}\r\n                {activeTab === 'pending' && (\r\n                    <PendingUsersActivation />\r\n                )}\r\n\r\n                {/* Tab: Logs */}\r\n                {\r\n                    activeTab === 'logs' && (\r\n                        <div className=\"space-y-6\">\r\n                            <h2 className=\"text-2xl font-bold text-gray-900\">Monitoreo Global</h2>\r\n\r\n                            {/* KPIs Globales */}\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Estad√≠sticas Cross-Tenant</h3>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                                    <div className=\"glass-card rounded-xl p-4\">\r\n                                        <p className=\"text-sm text-gray-600 mb-1\">Candidatos Totales</p>\r\n                                        <p className=\"text-3xl font-bold text-violet-600\">1,247</p>\r\n                                        <p className=\"text-xs text-green-600 mt-1\">+15% vs mes anterior</p>\r\n                                    </div>\r\n                                    <div className=\"glass-card rounded-xl p-4\">\r\n                                        <p className=\"text-sm text-gray-600 mb-1\">Entrevistas Hoy</p>\r\n                                        <p className=\"text-3xl font-bold text-cyan-600\">89</p>\r\n                                        <p className=\"text-xs text-gray-500 mt-1\">Across all tenants</p>\r\n                                    </div>\r\n                                    <div className=\"glass-card rounded-xl p-4\">\r\n                                        <p className=\"text-sm text-gray-600 mb-1\">Tasa Aprobaci√≥n</p>\r\n                                        <p className=\"text-3xl font-bold text-green-600\">68%</p>\r\n                                        <p className=\"text-xs text-green-600 mt-1\">+3% vs promedio</p>\r\n                                    </div>\r\n                                    <div className=\"glass-card rounded-xl p-4\">\r\n                                        <p className=\"text-sm text-gray-600 mb-1\">RQs Activos</p>\r\n                                        <p className=\"text-3xl font-bold text-amber-600\">34</p>\r\n                                        <p className=\"text-xs text-gray-500 mt-1\">12 urgentes</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* API Usage */}\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Uso de APIs</h3>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                    <div className=\"glass-card rounded-xl p-6\">\r\n                                        <div className=\"flex items-center justify-between mb-4\">\r\n                                            <h4 className=\"font-medium text-gray-900\">Gemini API</h4>\r\n                                            <span className=\"text-sm text-gray-500\">Este mes</span>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <div className=\"flex justify-between text-sm\">\r\n                                                <span className=\"text-gray-600\">Usado</span>\r\n                                                <span className=\"font-medium\">8,432 / 10,000 calls</span>\r\n                                            </div>\r\n                                            <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                                                <div className=\"bg-gradient-to-r from-violet-500 to-cyan-500 h-2 rounded-full\" style={{ width: '84%' }}></div>\r\n                                            </div>\r\n                                            <p className=\"text-xs text-amber-600\">‚ö†Ô∏è 84% del l√≠mite</p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"glass-card rounded-xl p-6\">\r\n                                        <div className=\"flex items-center justify-between mb-4\">\r\n                                            <h4 className=\"font-medium text-gray-900\">WhatsApp API</h4>\r\n                                            <span className=\"text-sm text-gray-500\">Este mes</span>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <div className=\"flex justify-between text-sm\">\r\n                                                <span className=\"text-gray-600\">Usado</span>\r\n                                                <span className=\"font-medium\">12,340 / 50,000 msgs</span>\r\n                                            </div>\r\n                                            <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                                                <div className=\"bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full\" style={{ width: '25%' }}></div>\r\n                                            </div>\r\n                                            <p className=\"text-xs text-green-600\">‚úì 25% del l√≠mite</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n\r\n                {/* Tab: Configuraci√≥n */}\r\n                {activeTab === 'configuracion' && (\r\n                    <ConfigurationView />\r\n                )}\r\n\r\n                {/* Tab: Candidatos Global */}\r\n                {activeTab === 'candidatos' && (\r\n                    <GlobalCandidatesView\r\n                        holdings={holdings.map(h => ({ id: h.id || h.firestoreId, nombre: h.nombre }))}\r\n                    />\r\n                )}\r\n\r\n            </main>\r\n\r\n            {/* Edit Holding Modal */}\r\n            <EditHoldingModal\r\n                show={showEditModal}\r\n                holding={selectedHolding as any}\r\n                onCancel={() => setShowEditModal(false)}\r\n                onSave={handleSaveHolding}\r\n            />\r\n\r\n            {/* Create Holding Modal */}\r\n            <CreateHoldingModal\r\n                show={showCreateModal}\r\n                onCancel={() => setShowCreateModal(false)}\r\n                onSave={handleCreateHolding}\r\n            />\r\n\r\n            {/* Create User Modal */}\r\n            <CreateUserModalSuperAdmin\r\n                show={showCreateUserModal}\r\n                onCancel={() => setShowCreateUserModal(false)}\r\n                onSave={handleCreateUser}\r\n            />\r\n\r\n            {/* Edit User Modal */}\r\n            <EditUserModalSuperAdmin\r\n                show={showEditUserModal}\r\n                user={selectedUser}\r\n                onCancel={() => setShowEditUserModal(false)}\r\n                onSave={handleSaveUser}\r\n            />\r\n            {/* Bulk Store Modal */}\r\n            <BulkUploadStoresModal\r\n                show={showBulkStoreModal}\r\n                holdingId={selectedHoldingIdForUpload}\r\n                onCancel={() => setShowBulkStoreModal(false)}\r\n                onComplete={() => setShowBulkStoreModal(false)}\r\n            />\r\n\r\n            {/* Bulk User Modal */}\r\n            <BulkUploadUsersModal\r\n                show={showBulkUserModal}\r\n                holdingId={holdingFilter !== 'todos' ? (holdings.find(h => h.nombre === holdingFilter) as any)?.id || (holdings.find(h => h.nombre === holdingFilter) as any)?.firestoreId : ''}\r\n                onCancel={() => setShowBulkUserModal(false)}\r\n                onComplete={() => setShowBulkUserModal(false)}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]}]