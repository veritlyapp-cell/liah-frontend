[{"filePath":"C:\\Users\\oscar\\Bot_Whatsapp\\lia-frontend\\app\\recruiter\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFilteredCandidates' is defined but never used.","line":5,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingAssignment' is assigned a value but never used.","line":30,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":77,"column":8,"nodeType":"ArrayExpression","endLine":77,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, marcas, selectedMarca]","fix":{"range":[3539,3562],"text":"[loadData, marcas, selectedMarca]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'applyFilters'. Either include it or remove the dependency array.","line":81,"column":8,"nodeType":"ArrayExpression","endLine":81,"endColumn":73,"suggestions":[{"desc":"Update the dependencies array to be: [candidates, selectedStores, selectedPosition, selectedCULStatus, applyFilters]","fix":{"range":[3623,3688],"text":"[candidates, selectedStores, selectedPosition, selectedCULStatus, applyFilters]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { getCandidatesByMarca, getFilteredCandidates, getPositionsByMarca, getStoresByMarca } from '@/lib/firestore/recruiter-queries';\r\nimport type { Candidate } from '@/lib/firestore/candidates';\r\nimport RecruiterCandidatesView from '@/components/RecruiterCandidatesView';\r\nimport FiltersSidebar from '@/components/FiltersSidebar';\r\nimport ConfigurationView from '@/components/ConfigurationView';\r\nimport RQTrackingView from '@/components/admin/RQTrackingView';\r\nimport DashboardHeader from '@/components/DashboardHeader';\r\n\r\nexport default function RecruiterDashboard() {\r\n    const { user } = useAuth();\r\n    const [candidates, setCandidates] = useState<Candidate[]>([]);\r\n    const [filteredCandidates, setFilteredCandidates] = useState<Candidate[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [positions, setPositions] = useState<string[]>([]);\r\n    const [stores, setStores] = useState<Array<{ id: string, nombre: string }>>([]);\r\n\r\n    // Filters state\r\n    const [selectedStores, setSelectedStores] = useState<string[]>([]);\r\n    const [selectedPosition, setSelectedPosition] = useState<string>('');\r\n    const [selectedCULStatus, setSelectedCULStatus] = useState<string>('');\r\n    const [activeTab, setActiveTab] = useState<'candidatos' | 'requerimientos' | 'analitica' | 'configuracion'>('requerimientos');\r\n\r\n    // Marcas from user assignment (can be multiple)\r\n    const [marcas, setMarcas] = useState<{ id: string; nombre: string }[]>([]);\r\n    const [selectedMarca, setSelectedMarca] = useState<string>('all');\r\n    const [loadingAssignment, setLoadingAssignment] = useState(true);\r\n\r\n    // Load user assignment to get marcas\r\n    useEffect(() => {\r\n        async function loadAssignment() {\r\n            if (!user) return;\r\n            try {\r\n                const { getUserAssignment } = await import('@/lib/firestore/user-assignments');\r\n                const assignment = await getUserAssignment(user.uid);\r\n\r\n                const loadedMarcas: { id: string; nombre: string }[] = [];\r\n\r\n                // Get from assignedMarca (primary)\r\n                if (assignment?.assignedMarca?.marcaId) {\r\n                    loadedMarcas.push({\r\n                        id: assignment.assignedMarca.marcaId,\r\n                        nombre: assignment.assignedMarca.marcaNombre || 'Marca'\r\n                    });\r\n                }\r\n\r\n                // Also get from assignedStores (additional marcas)\r\n                if (assignment?.assignedStores) {\r\n                    assignment.assignedStores.forEach(store => {\r\n                        if (store.marcaId && !loadedMarcas.some(m => m.id === store.marcaId)) {\r\n                            loadedMarcas.push({\r\n                                id: store.marcaId,\r\n                                nombre: store.marcaId // Will be replaced if we have the name\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n\r\n                setMarcas(loadedMarcas);\r\n                console.log('‚úÖ Recruiter marcas loaded:', loadedMarcas.length);\r\n            } catch (error) {\r\n                console.error('Error loading assignment:', error);\r\n            } finally {\r\n                setLoadingAssignment(false);\r\n            }\r\n        }\r\n        loadAssignment();\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (marcas.length > 0) {\r\n            loadData();\r\n        }\r\n    }, [marcas, selectedMarca]);\r\n\r\n    useEffect(() => {\r\n        applyFilters();\r\n    }, [candidates, selectedStores, selectedPosition, selectedCULStatus]);\r\n\r\n    async function loadData() {\r\n        if (marcas.length === 0) return;\r\n        setLoading(true);\r\n        try {\r\n            // Determine which marcas to load\r\n            const marcasToLoad = selectedMarca === 'all'\r\n                ? marcas\r\n                : marcas.filter(m => m.id === selectedMarca);\r\n\r\n            // Load data for all selected marcas and combine\r\n            const allCandidates: Candidate[] = [];\r\n            const allPositions: Set<string> = new Set();\r\n            const allStores: Array<{ id: string, nombre: string }> = [];\r\n\r\n            for (const marca of marcasToLoad) {\r\n                const [candidatesData, positionsData, storesData] = await Promise.all([\r\n                    getCandidatesByMarca(marca.id),\r\n                    getPositionsByMarca(marca.id),\r\n                    getStoresByMarca(marca.id)\r\n                ]);\r\n\r\n                allCandidates.push(...candidatesData);\r\n                positionsData.forEach(p => allPositions.add(p));\r\n                storesData.forEach(s => {\r\n                    if (!allStores.some(existing => existing.id === s.id)) {\r\n                        allStores.push(s);\r\n                    }\r\n                });\r\n            }\r\n\r\n            setCandidates(allCandidates);\r\n            setFilteredCandidates(allCandidates);\r\n            setPositions(Array.from(allPositions));\r\n            setStores(allStores);\r\n        } catch (error) {\r\n            console.error('Error loading recruiter data:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    function applyFilters() {\r\n        let filtered = [...candidates];\r\n\r\n        // Filter by stores\r\n        if (selectedStores.length > 0) {\r\n            filtered = filtered.filter(c =>\r\n                c.applications?.some(app => selectedStores.includes(app.tiendaId))\r\n            );\r\n        }\r\n\r\n        // Filter by position\r\n        if (selectedPosition) {\r\n            filtered = filtered.filter(c =>\r\n                c.applications?.some(app => app.posicion === selectedPosition)\r\n            );\r\n        }\r\n\r\n        // Filter by CUL status\r\n        if (selectedCULStatus) {\r\n            filtered = filtered.filter(c => c.culStatus === selectedCULStatus);\r\n        }\r\n        // Removed hard exclusion of 'apto' so they appear in \"Todos\" list as requested.\r\n\r\n        setFilteredCandidates(filtered);\r\n    }\r\n\r\n    function clearFilters() {\r\n        setSelectedStores([]);\r\n        setSelectedPosition('');\r\n        setSelectedCULStatus('');\r\n    }\r\n\r\n    // Calculate stats\r\n    const stats = {\r\n        total: candidates.length,\r\n        pending: candidates.filter(c =>\r\n            c.applications?.some(app => app.status === 'completed')\r\n        ).length,\r\n        approved: candidates.filter(c =>\r\n            c.applications?.some(app => app.status === 'approved')\r\n        ).length,\r\n        culAptos: candidates.filter(c => c.culStatus === 'apto').length,\r\n        culNoAptos: candidates.filter(c => c.culStatus === 'no_apto').length,\r\n        hired: candidates.filter(c =>\r\n            c.applications?.some(app => app.hiredStatus === 'hired')\r\n        ).length,\r\n        notHired: candidates.filter(c =>\r\n            c.applications?.some(app => app.hiredStatus === 'not_hired')\r\n        ).length,\r\n        pendingHire: candidates.filter(c =>\r\n            c.culStatus === 'apto' && !c.applications?.some(app => app.hiredStatus)\r\n        ).length,\r\n        selected: candidates.filter(c => c.selectionStatus === 'selected').length\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-screen\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"text-4xl mb-4\">‚è≥</div>\r\n                    <p className=\"text-gray-600\">Cargando candidatos...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50\">\r\n            {/* Header */}\r\n            <DashboardHeader\r\n                title=\"Dashboard Recruiter\"\r\n                marcaId={selectedMarca !== 'all' ? selectedMarca : marcas[0]?.id}\r\n                onConfigClick={() => setActiveTab('configuracion')}\r\n            />\r\n\r\n            {/* Navigation Tabs */}\r\n            <div className=\"bg-white border-b\">\r\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n                    <div className=\"flex gap-4\">\r\n                        <button\r\n                            onClick={() => setActiveTab('requerimientos')}\r\n                            className={`px-4 py-3 font-medium transition-colors border-b-2 ${activeTab === 'requerimientos'\r\n                                ? 'border-violet-600 text-violet-600'\r\n                                : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                                }`}\r\n                        >\r\n                            üìã Requerimientos\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setActiveTab('candidatos')}\r\n                            className={`px-4 py-3 font-medium transition-colors border-b-2 ${activeTab === 'candidatos'\r\n                                ? 'border-violet-600 text-violet-600'\r\n                                : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                                }`}\r\n                        >\r\n                            üë• Candidatos\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setActiveTab('analitica')}\r\n                            className={`px-4 py-3 font-medium transition-colors border-b-2 ${activeTab === 'analitica'\r\n                                ? 'border-violet-600 text-violet-600'\r\n                                : 'border-transparent text-gray-500 hover:text-gray-700'\r\n                                }`}\r\n                        >\r\n                            üìä Anal√≠tica\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tab Content */}\r\n\r\n            {/* Multi-Brand Selector */}\r\n            {\r\n                marcas.length > 1 && (\r\n                    <div className=\"bg-white border-b border-gray-200\">\r\n                        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <label className=\"text-sm font-medium text-gray-700\">\r\n                                    üè™ Filtrar por Marca:\r\n                                </label>\r\n                                <select\r\n                                    value={selectedMarca}\r\n                                    onChange={(e) => setSelectedMarca(e.target.value)}\r\n                                    className=\"px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-violet-500 bg-white min-w-[200px]\"\r\n                                >\r\n                                    <option value=\"all\">üìä Todas las Marcas ({marcas.length})</option>\r\n                                    {marcas.map(m => (\r\n                                        <option key={m.id} value={m.id}>{m.nombre}</option>\r\n                                    ))}\r\n                                </select>\r\n                                {selectedMarca !== 'all' && (\r\n                                    <button\r\n                                        onClick={() => setSelectedMarca('all')}\r\n                                        className=\"text-sm text-violet-600 hover:text-violet-700 font-medium\"\r\n                                    >\r\n                                        Mostrar todas\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {\r\n                activeTab === 'candidatos' && (\r\n                    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n                        <div className=\"grid grid-cols-4 gap-4 mb-6\">\r\n                            <div className=\"bg-white rounded-lg border border-gray-200 p-4\">\r\n                                <p className=\"text-sm text-gray-600\">Total Candidatos</p>\r\n                                <p className=\"text-3xl font-bold text-gray-900\">{stats.total}</p>\r\n                            </div>\r\n                            <div className=\"bg-white rounded-lg border border-gray-200 p-4\">\r\n                                <p className=\"text-sm text-gray-600\">Aprobados por SM</p>\r\n                                <p className=\"text-3xl font-bold text-blue-600\">{stats.approved}</p>\r\n                                <p className=\"text-xs text-gray-500 mt-1\">Esperando evaluaci√≥n CUL</p>\r\n                            </div>\r\n                            <div className=\"bg-white rounded-lg border border-gray-200 p-4\">\r\n                                <p className=\"text-sm text-gray-600\">CUL Aptos</p>\r\n                                <p className=\"text-3xl font-bold text-green-600\">{stats.culAptos}</p>\r\n                                <p className=\"text-xs text-gray-500 mt-1\">Listos para ingresar</p>\r\n                            </div>\r\n                            <div className=\"bg-white rounded-lg border border-gray-200 p-4\">\r\n                                <p className=\"text-sm text-gray-600\">CUL No Aptos</p>\r\n                                <p className=\"text-3xl font-bold text-red-600\">{stats.culNoAptos}</p>\r\n                                <p className=\"text-xs text-gray-500 mt-1\">No pueden ingresar</p>\r\n                            </div>\r\n                            <div className=\"bg-white rounded-lg border border-emerald-200 p-4 shadow-sm\">\r\n                                <p className=\"text-sm text-emerald-700 font-medium\">üéØ Seleccionados</p>\r\n                                <p className=\"text-3xl font-bold text-emerald-600\">{stats.selected}</p>\r\n                                <p className=\"text-xs text-emerald-600 mt-1\">Listos para exportar</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Hiring Stats Row - Reordenado: Pendiente ‚Üí Ingreso ‚Üí No Ingreso */}\r\n                        <div className=\"grid grid-cols-3 gap-4 mb-6\">\r\n                            <div className=\"bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg border border-yellow-200 p-4\">\r\n                                <p className=\"text-sm text-yellow-700 font-medium\">‚è≥ Pendientes Ingreso</p>\r\n                                <p className=\"text-3xl font-bold text-yellow-900\">{stats.pendingHire}</p>\r\n                                <p className=\"text-xs text-yellow-600 mt-1\">Aptos esperando confirmaci√≥n</p>\r\n                            </div>\r\n                            <div className=\"bg-gradient-to-br from-green-50 to-green-100 rounded-lg border border-green-200 p-4\">\r\n                                <p className=\"text-sm text-green-700 font-medium\">‚úÖ Ingresaron</p>\r\n                                <p className=\"text-3xl font-bold text-green-900\">{stats.hired}</p>\r\n                                <p className=\"text-xs text-green-600 mt-1\">Confirmado por SM</p>\r\n                            </div>\r\n                            <div className=\"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg border border-gray-200 p-4\">\r\n                                <p className=\"text-sm text-gray-700 font-medium\">‚ùå No Ingresaron</p>\r\n                                <p className=\"text-3xl font-bold text-gray-900\">{stats.notHired}</p>\r\n                                <p className=\"text-xs text-gray-600 mt-1\">Desistieron o rechazados</p>\r\n                            </div>\r\n                        </div>\r\n\r\n\r\n                        {/* Main Content */}\r\n                        <div className=\"flex gap-6\">\r\n                            {/* Filtros Sidebar */}\r\n                            <FiltersSidebar\r\n                                stores={stores}\r\n                                positions={positions}\r\n                                selectedStores={selectedStores}\r\n                                setSelectedStores={setSelectedStores}\r\n                                selectedPosition={selectedPosition}\r\n                                setSelectedPosition={setSelectedPosition}\r\n                                selectedCULStatus={selectedCULStatus}\r\n                                setSelectedCULStatus={setSelectedCULStatus}\r\n                                onClearFilters={clearFilters}\r\n                            />\r\n\r\n                            {/* Candidates List */}\r\n                            <div className=\"flex-1\">\r\n                                <RecruiterCandidatesView\r\n                                    candidates={filteredCandidates}\r\n                                    onRefresh={loadData}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {\r\n                activeTab === 'requerimientos' && (\r\n                    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n                        <RQTrackingView\r\n                            holdingId=\"\"\r\n                            marcas={marcas}\r\n                        />\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {\r\n                activeTab === 'analitica' && (\r\n                    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n                        <div className=\"bg-white rounded-2xl shadow-lg border border-gray-100 p-8 text-center\">\r\n                            <div className=\"text-6xl mb-4\">üìä</div>\r\n                            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Dashboard de Anal√≠tica</h2>\r\n                            <p className=\"text-gray-600 mb-6\">\r\n                                Visualiza m√©tricas de reclutamiento, funnel de candidatos y tendencias.\r\n                            </p>\r\n                            <a\r\n                                href=\"/analytics\"\r\n                                className=\"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-violet-600 to-cyan-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all\"\r\n                            >\r\n                                Abrir Dashboard Completo ‚Üí\r\n                            </a>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {\r\n                activeTab === 'configuracion' && (\r\n                    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n                        <ConfigurationView />\r\n                    </div>\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]}]